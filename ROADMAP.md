# Aether Learning Platform - 完整开发路线图

**项目概述:** 基于知识图谱的智能学习平台，包含后端API（FastAPI + PostgreSQL + Neo4j + Redis）和iOS客户端（SwiftUI + SwiftData）

**最后更新:** 2025-10-25

---

## 📊 当前状态总览

### 后端状态
- ✅ **已完成:** 用户认证、课程管理、测验基础流程、知识图谱管理、异步任务队列
- ⚠️ **部分完成:** 批量导入、问题管理
- ❌ **未完成:** 评分系统、测验结果查询、注册验证、填空题/计算题评分逻辑

### iOS端状态
- ✅ **已完成:** 认证流程、选择题测验、课程浏览/注册、学习统计可视化
- ⚠️ **部分完成:** 用户资料页面、题型支持
- ❌ **未完成:** 填空题UI、计算题UI、测验历史/回顾、离线支持、Token刷新

---

## 🎯 Phase 1: 核心功能完善 (Critical Priority)

**目标:** 完成MVP的核心功能，使系统可以端到端运行

**预计时间:** 2-3周

### 1.1 后端 - 评分系统实现 ⭐️⭐️⭐️
**优先级:** 最高 | **预计时间:** 3-5天

#### 任务清单:
- [ ] **实现 `handle_grade_submission` 任务处理器**
  - 文件位置: `app/worker/handlers.py`
  - 从Redis任务队列读取提交数据
  - 解析用户答案和正确答案
  - 调用评分逻辑

- [ ] **实现选择题评分逻辑**
  - 创建文件: `app/services/grading_service.py`
  - 函数: `grade_multiple_choice(user_answer: int, correct_answer: int) -> bool`
  - 简单整数比较

- [ ] **实现填空题评分逻辑**
  - 函数: `grade_fill_in_blank(user_answer: List[str], expected_answers: List[str]) -> bool`
  - 支持大小写不敏感匹配
  - 支持多个正确答案（或逻辑）
  - 去除首尾空格

- [ ] **实现计算题评分逻辑**
  - 函数: `grade_calculation(user_answer: List[str], expected_answers: List[str], precision: int) -> bool`
  - 数值比较（浮点数精度处理）
  - 支持科学记数法
  - 支持多个正确答案

- [ ] **更新数据库记录**
  - 更新 `SubmissionAnswer.is_correct` 字段
  - 计算总分并更新 `QuizAttempt.score`
  - 更新 `QuizAttempt.status` 为 COMPLETED
  - 设置 `QuizAttempt.submitted_at` 时间戳

- [ ] **错误处理和日志**
  - 评分失败时的重试逻辑
  - 详细日志记录（用户ID、提交ID、评分结果）
  - 异常答案格式的处理

#### 依赖关系:
- 无前置依赖
- 阻塞: 1.4 (测验结果查询)

#### 验收标准:
- [ ] 提交测验后，`is_correct` 字段正确设置
- [ ] `QuizAttempt.score` 正确计算
- [ ] 三种题型都能正确评分
- [ ] 异常情况有适当错误处理

---

### 1.2 后端 - 课程注册验证 ⭐️⭐️⭐️
**优先级:** 高 | **预计时间:** 1天

#### 任务清单:
- [ ] **在 `start_a_quiz` 端点添加注册检查**
  - 文件位置: `app/routes/quiz.py:197`
  - 查询 `Enrollment` 表验证用户已注册课程
  - 未注册返回 403 Forbidden 错误
  - 错误消息: "User is not enrolled in this course"

- [ ] **添加辅助函数**
  - 创建: `app/crud/enrollment.py`
  - 函数: `check_user_enrollment(db: Session, user_id: UUID, course_id: str) -> bool`

- [ ] **单元测试**
  - 测试已注册用户可以开始测验
  - 测试未注册用户被拒绝
  - 测试不存在的课程返回404

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 未注册用户无法开始测验
- [ ] 已注册用户可以正常开始测验
- [ ] 错误消息清晰明确

---

### 1.3 后端 - 测验结果查询端点 ⭐️⭐️⭐️
**优先级:** 高 | **预计时间:** 2-3天

#### 任务清单:
- [ ] **创建查询单个测验结果端点**
  - `GET /submissions/{attempt_id}`
  - 返回: 总分、每题详情、正确/错误答案、用户答案
  - 权限: 仅允许用户查看自己的提交
  - Schema: `QuizResultResponse`

- [ ] **创建测验历史列表端点**
  - `GET /users/me/quiz-history`
  - 查询参数: `course_id` (可选), `limit`, `offset`
  - 返回: 测验列表（时间、课程、分数、状态）
  - 支持分页

- [ ] **创建详细答案回顾端点**
  - `GET /users/me/quiz-history/{attempt_id}/details`
  - 返回: 每题的问题文本、选项、用户答案、正确答案、是否正确
  - 仅显示已完成的测验

- [ ] **创建 Pydantic Schemas**
  - 文件位置: `app/schemas/quiz.py`
  - `QuizResultResponse`
  - `QuizHistoryItem`
  - `QuizDetailResponse`
  - `QuestionReviewDetail`

- [ ] **实现 CRUD 操作**
  - 文件位置: `app/crud/quiz.py`
  - `get_quiz_attempt_with_answers()`
  - `get_user_quiz_history()`
  - `get_quiz_details_for_review()`

#### 依赖关系:
- 依赖: 1.1 (评分系统)

#### 验收标准:
- [ ] 用户可以查看自己的测验结果
- [ ] 用户只能查看自己的提交（无权限看他人）
- [ ] 历史记录支持分页
- [ ] 详细视图显示所有问题和答案

---

### 1.4 iOS端 - 测验结果显示 ⭐️⭐️⭐️
**优先级:** 高 | **预计时间:** 2-3天

#### 任务清单:
- [ ] **创建测验结果详情视图**
  - 创建文件: `ios/Aether/Aether/View/QuizView/QuizResultDetailView.swift`
  - 显示每题的问题、用户答案、正确答案
  - 用颜色区分正确/错误答案
  - 显示总分和百分比

- [ ] **创建测验历史列表视图**
  - 创建文件: `ios/Aether/Aether/View/QuizView/QuizHistoryView.swift`
  - 显示所有完成的测验
  - 显示日期、课程名称、分数
  - 点击进入详情视图

- [ ] **更新 HomeView 显示历史入口**
  - 添加导航链接到历史视图
  - 显示最近的测验成绩

- [ ] **创建 API 端点模型**
  - 文件位置: `ios/Aether/Aether/Models/Endpoint.swift`
  - `FetchQuizResultEndpoint`
  - `FetchQuizHistoryEndpoint`

- [ ] **更新 QuizViewModel**
  - 添加方法: `fetchQuizResult(attemptId:)`
  - 添加方法: `fetchQuizHistory()`
  - 添加属性: `quizHistory`, `currentResult`

#### 依赖关系:
- 依赖: 1.3 (后端结果查询端点)

#### 验收标准:
- [ ] 用户完成测验后可以看到详细结果
- [ ] 历史列表显示所有测验记录
- [ ] UI清晰显示对错信息
- [ ] 支持从历史记录查看旧测验

---

### 1.5 iOS端 - 填空题和计算题UI ⭐️⭐️
**优先级:** 中 | **预计时间:** 2-3天

#### 任务清单:
- [ ] **创建填空题输入组件**
  - 创建文件: `ios/Aether/Aether/View/QuizView/FillInTheBlankInputView.swift`
  - 使用 TextField 接受文本输入
  - 支持多个空格（如有需要）
  - 输入验证和格式化

- [ ] **创建计算题输入组件**
  - 创建文件: `ios/Aether/Aether/View/QuizView/CalculationInputView.swift`
  - 数字键盘
  - 支持小数点和负号
  - 实时格式验证

- [ ] **更新 QuizView 集成新题型**
  - 根据 `question.type` 显示不同输入组件
  - 移除 "Unsupported Question Type" 占位符

- [ ] **更新答案提交逻辑**
  - 更新 `QuizViewModel.submitAnswer()`
  - 支持 `FillInTheBlankAnswer` 和 `CalculationAnswer`
  - 本地验证输入格式

#### 依赖关系:
- 依赖: 1.1 (后端评分逻辑)

#### 验收标准:
- [ ] 填空题显示文本输入框
- [ ] 计算题显示数字键盘
- [ ] 答案可以正确提交到后端
- [ ] UI/UX 与选择题保持一致

---

## 🚀 Phase 2: 功能增强 (Important Features)

**目标:** 增强用户体验和管理功能

**预计时间:** 3-4周

### 2.1 后端 - 批量导入功能完善 ⭐️⭐️
**优先级:** 中 | **预计时间:** 3-4天

#### 任务清单:
- [ ] **实现 `handle_bulk_import_question` 处理器**
  - 文件位置: `app/worker/handlers.py`
  - CSV解析逻辑（pandas或csv库）
  - 验证CSV格式和必填字段
  - 批量创建Neo4j Question节点
  - 错误记录和报告

- [ ] **实现 `handle_bulk_import_nodes` 处理器**
  - 批量创建KnowledgeNode
  - 验证课程存在性
  - 支持幂等操作（避免重复导入）

- [ ] **实现 `handle_bulk_import_relations` 处理器**
  - 批量创建知识节点关系
  - 验证节点存在性
  - 循环依赖检测（可选）

- [ ] **CSV模板和文档**
  - 创建示例CSV文件
  - 文档说明字段格式
  - 错误代码和解决方法

- [ ] **临时文件清理**
  - 处理完成后删除上传的CSV文件
  - 实现文件过期清理（24小时后自动删除）

#### CSV格式定义:

**questions.csv:**
```csv
question_id,text,type,difficulty,course_id,node_id,options,correct_answer
q1,"What is 2+2?",multiple_choice,easy,course123,node1,"[""2"",""3"",""4"",""5""]",2
```

**nodes.csv:**
```csv
node_id,name,description,course_id
node1,Addition Basics,Basic addition operations,course123
```

**relationships.csv:**
```csv
from_node_id,to_node_id,relationship_type
node1,node2,HAS_PREREQUISITES
node1,node3,HAS_SUBTOPIC
```

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] CSV文件可以成功解析
- [ ] 批量导入数据正确创建
- [ ] 错误格式返回清晰错误信息
- [ ] 临时文件自动清理

---

### 2.2 后端 - 知识图谱验证和优化 ⭐️⭐️
**优先级:** 中 | **预计时间:** 2-3天

#### 任务清单:
- [ ] **循环依赖检测**
  - 创建文件: `app/services/graph_validation.py`
  - 函数: `detect_circular_dependencies(node_id: str) -> bool`
  - 使用深度优先搜索（DFS）
  - 在创建关系前验证

- [ ] **关系路径验证**
  - 验证前置关系的合理性
  - 限制关系深度（如：最多5层前置）
  - 防止孤立节点

- [ ] **Neo4j约束和索引**
  - 取消注释 `app/core/database.py` 中的约束代码
  - 为常用查询添加索引
  - 唯一性约束: `course_id`, `node_id`, `question_id`

- [ ] **图谱查询优化**
  - 优化问题选择查询（基于知识节点）
  - 缓存常用查询结果（Redis）
  - 批量查询减少数据库往返

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 创建循环关系时返回错误
- [ ] Neo4j约束正常工作
- [ ] 查询性能提升

---

### 2.3 后端 - 课程退出/取消注册 ⭐️
**优先级:** 低 | **预计时间:** 1天

#### 任务清单:
- [ ] **实现退课端点**
  - `DELETE /courses/{course_id}/enrollments`
  - 验证用户已注册该课程
  - 删除Enrollment记录
  - 删除Neo4j中的ENROLLED_IN关系

- [ ] **退课规则**
  - 如果已有测验记录，考虑软删除（标记为inactive）
  - 如果无测验记录，直接删除

- [ ] **更新课程列表端点**
  - 返回注册状态时反映退课

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 用户可以成功退出课程
- [ ] 退课后不再显示为已注册
- [ ] 退课后无法开始该课程的测验

---

### 2.4 iOS端 - Token刷新机制 ⭐️⭐️
**优先级:** 中 | **预计时间:** 2天

#### 任务清单:
- [ ] **实现Token过期检测**
  - 文件位置: `ios/Aether/Aether/ViewModels/Network/NetworkServicing.swift`
  - 解析JWT获取过期时间
  - 在请求前检查Token是否即将过期

- [ ] **实现刷新Token端点**
  - 创建: `RefreshTokenEndpoint`
  - `POST /users/refresh`
  - 使用refresh token获取新的access token

- [ ] **自动刷新逻辑**
  - Token过期前5分钟自动刷新
  - 刷新失败时登出用户
  - 更新KeyChain中的token

- [ ] **请求重试**
  - 401错误时自动尝试刷新token
  - 刷新成功后重试原请求
  - 最多重试1次

#### 依赖关系:
- 可能需要后端支持（检查 `/users/refresh` 端点是否存在）

#### 验收标准:
- [ ] Token即将过期时自动刷新
- [ ] 用户无感知刷新过程
- [ ] 刷新失败时正确登出

---

### 2.5 iOS端 - 用户资料页面完善 ⭐️
**优先级:** 低 | **预计时间:** 2-3天

#### 任务清单:
- [ ] **完善UserView UI**
  - 文件位置: `ios/Aether/Aether/View/UserView.swift`
  - 显示用户头像（支持上传，或使用默认）
  - 显示用户名、邮箱
  - 显示学习统计（总测验数、平均分、最长连续天数）

- [ ] **添加设置选项**
  - 修改密码
  - 通知设置
  - 退出登录按钮

- [ ] **创建编辑资料视图**
  - 创建文件: `ios/Aether/Aether/View/UserView/EditProfileView.swift`
  - 修改用户名
  - 上传头像（可选）

- [ ] **后端支持**（如需要）
  - 检查是否有更新用户信息的端点
  - 可能需要添加 `PATCH /users/me`

#### 依赖关系:
- 可能需要后端新增端点

#### 验收标准:
- [ ] 显示完整用户信息
- [ ] 可以编辑用户名
- [ ] 退出登录功能正常
- [ ] UI美观统一

---

### 2.6 iOS端 - 离线支持和数据同步 ⭐️⭐️
**优先级:** 中 | **预计时间:** 4-5天

#### 任务清单:
- [ ] **实现离线数据缓存**
  - 使用SwiftData缓存课程列表
  - 缓存已开始的测验
  - 缓存用户历史记录

- [ ] **离线答题支持**
  - 离线时允许继续答题
  - 将答案保存到本地队列
  - 网络恢复时自动同步

- [ ] **同步队列管理**
  - 创建文件: `ios/Aether/Aether/Services/SyncService.swift`
  - 记录待同步操作（答案提交、测验完成）
  - 网络恢复时按顺序执行

- [ ] **网络状态监控**
  - 使用 `Network.framework` 监控网络状态
  - UI显示在线/离线状态
  - 离线时禁用需要网络的功能

- [ ] **冲突解决策略**
  - 服务器数据优先
  - 本地未同步数据标记为"待同步"

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 离线时可以继续答已开始的测验
- [ ] 网络恢复后数据自动同步
- [ ] 用户清晰知道网络状态
- [ ] 无数据丢失

---

## 🎨 Phase 3: 优化和增强 (Nice to Have)

**目标:** 提升性能、用户体验和系统稳定性

**预计时间:** 3-4周

### 3.1 后端 - 性能优化 ⭐️
**优先级:** 低 | **预计时间:** 3-4天

#### 任务清单:
- [ ] **数据库查询优化**
  - 分析慢查询（使用PostgreSQL EXPLAIN）
  - 添加必要的索引
  - 优化N+1查询问题

- [ ] **Redis缓存策略**
  - 缓存课程列表（TTL: 5分钟）
  - 缓存知识节点数据（TTL: 10分钟）
  - 缓存用户Session数据
  - 实现缓存失效策略

- [ ] **分页实现**
  - 为所有列表端点添加分页
  - 使用cursor-based pagination（更高效）
  - 限制单次查询最大结果数

- [ ] **Neo4j查询优化**
  - 使用Cypher查询分析器
  - 添加适当的索引
  - 批量操作优化

- [ ] **API响应压缩**
  - 启用Gzip压缩
  - 减少响应体大小

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 接口响应时间 < 200ms (P95)
- [ ] 数据库查询优化后提升50%
- [ ] 缓存命中率 > 80%

---

### 3.2 后端 - 安全增强 ⭐️⭐️
**优先级:** 中 | **预计时间:** 2-3天

#### 任务清单:
- [ ] **速率限制**
  - 安装 `slowapi` 或 `fastapi-limiter`
  - 登录端点: 5次/分钟
  - 注册端点: 3次/分钟
  - 其他端点: 100次/分钟
  - IP级别限制

- [ ] **CORS配置**
  - 配置允许的origins
  - 生产环境严格限制
  - 开发环境适当放宽

- [ ] **输入验证增强**
  - 所有字符串字段长度限制
  - Email格式严格验证
  - 密码强度要求
  - SQL注入防护（确认SQLAlchemy正确使用）

- [ ] **安全头部**
  - 添加 `X-Content-Type-Options`
  - 添加 `X-Frame-Options`
  - 添加 `Content-Security-Policy`
  - 使用 `fastapi-security` 库

- [ ] **敏感信息保护**
  - 日志中隐藏密码和token
  - 错误响应不泄露内部信息
  - 环境变量管理（使用 `.env`）

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 速率限制正常工作
- [ ] CORS配置正确
- [ ] 通过基础安全扫描（如OWASP ZAP）
- [ ] 日志中无敏感信息

---

### 3.3 后端 - API文档改进 ⭐️
**优先级:** 低 | **预计时间:** 2天

#### 任务清单:
- [ ] **OpenAPI Schema定制**
  - 文件位置: `app/main.py`
  - 自定义标题、描述、版本
  - 添加联系信息和许可证

- [ ] **端点文档完善**
  - 为所有端点添加详细docstring
  - 描述参数含义
  - 提供示例请求和响应
  - 列出可能的错误代码

- [ ] **Schema示例**
  - 为所有Pydantic模型添加 `Config.schema_extra` 示例
  - 使用真实数据示例

- [ ] **认证文档**
  - 说明如何获取Token
  - 说明如何在请求中使用Token
  - Token刷新流程说明

- [ ] **导出Postman Collection**
  - 从OpenAPI导出
  - 添加环境变量配置

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] Swagger UI清晰易懂
- [ ] 所有端点有详细说明
- [ ] 示例可以直接使用

---

### 3.4 iOS端 - UI/UX优化 ⭐️
**优先级:** 低 | **预计时间:** 3-4天

#### 任务清单:
- [ ] **加载状态优化**
  - 使用骨架屏（Skeleton View）替代转圈
  - 优化加载动画
  - 添加加载进度条（如适用）

- [ ] **错误状态改进**
  - 统一错误提示样式
  - 提供重试按钮
  - 网络错误的友好提示

- [ ] **空状态设计**
  - 无课程时的提示
  - 无测验历史时的提示
  - 添加引导性CTA按钮

- [ ] **动画和过渡**
  - 页面切换动画
  - 答题时的微交互
  - 成功/失败的视觉反馈

- [ ] **无障碍支持**
  - VoiceOver支持
  - 动态字体大小
  - 高对比度模式

- [ ] **深色模式优化**
  - 确保所有颜色在深色模式下正常
  - 测试所有页面

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 所有状态有适当UI反馈
- [ ] 动画流畅不卡顿
- [ ] 通过无障碍测试
- [ ] 深色模式无视觉问题

---

### 3.5 后端 - 学习分析和推荐系统 ⭐️⭐️
**优先级:** 中 | **预计时间:** 5-7天

#### 任务清单:
- [ ] **学习进度追踪**
  - 创建文件: `app/services/analytics_service.py`
  - 计算每个知识节点的掌握度
  - 基于测验结果评估
  - 存储在PostgreSQL或Redis

- [ ] **知识点推荐算法**
  - 基于知识图谱的前置关系
  - 推荐下一个应该学习的节点
  - 考虑用户当前掌握情况

- [ ] **个性化题目推荐**
  - 基于错题记录
  - 推荐薄弱知识点的题目
  - 难度自适应（根据正确率调整）

- [ ] **学习路径生成**
  - 从起点到目标知识点的最优路径
  - 使用Neo4j的路径查找算法
  - 考虑前置关系

- [ ] **统计报告端点**
  - `GET /users/me/statistics`
  - 返回: 总测验数、平均分、各知识点掌握度、薄弱环节
  - 支持时间范围过滤（本周、本月、全部）

- [ ] **知识点掌握度可视化数据**
  - `GET /users/me/knowledge-mastery`
  - 返回每个知识点的掌握百分比
  - 前端可以绘制雷达图或热力图

#### 依赖关系:
- 依赖: 1.1 (评分系统)
- 依赖: 1.3 (测验结果查询)

#### 验收标准:
- [ ] 可以准确计算知识点掌握度
- [ ] 推荐系统给出合理建议
- [ ] 学习路径符合前置关系
- [ ] 统计数据准确

---

### 3.6 iOS端 - 学习分析可视化 ⭐️⭐️
**优先级:** 中 | **预计时间:** 4-5天

#### 任务清单:
- [ ] **知识掌握度雷达图**
  - 创建文件: `ios/Aether/Aether/View/Analytics/KnowledgeMasteryChart.swift`
  - 使用 Swift Charts
  - 显示各知识点的掌握程度

- [ ] **学习进度仪表盘**
  - 创建文件: `ios/Aether/Aether/View/Analytics/LearningDashboard.swift`
  - 显示总体进度
  - 显示薄弱环节
  - 显示推荐学习内容

- [ ] **测验成绩趋势图**
  - 折线图显示历史成绩变化
  - 按课程分类
  - 按时间范围过滤

- [ ] **学习路径可视化**
  - 显示知识图谱的子集
  - 高亮已掌握节点
  - 显示推荐学习路径

- [ ] **集成到HomeView**
  - 将分析图表添加到首页
  - 滚动浏览不同统计信息

#### 依赖关系:
- 依赖: 3.5 (后端分析端点)

#### 验收标准:
- [ ] 图表美观且信息清晰
- [ ] 数据更新及时
- [ ] 性能流畅（无卡顿）

---

### 3.7 后端 - 测试和CI/CD ⭐️⭐️
**优先级:** 中 | **预计时间:** 5-7天

#### 任务清单:
- [ ] **单元测试**
  - 创建目录: `app/tests/`
  - 测试所有CRUD操作
  - 测试评分逻辑
  - 测试认证流程
  - 使用 `pytest`

- [ ] **集成测试**
  - 测试完整的API流程
  - 使用测试数据库
  - 测试多数据库交互

- [ ] **API测试**
  - 使用 `httpx` 或 `requests`
  - 测试所有端点
  - 测试错误情况

- [ ] **Neo4j测试**
  - 使用测试Neo4j实例
  - 测试知识图谱操作
  - 测试关系创建和查询

- [ ] **测试覆盖率**
  - 目标: > 80%
  - 使用 `pytest-cov`
  - 生成覆盖率报告

- [ ] **CI/CD Pipeline**
  - 使用GitHub Actions或GitLab CI
  - 自动运行测试
  - 自动部署到staging环境
  - Linting和代码格式检查（black, flake8, mypy）

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 测试覆盖率 > 80%
- [ ] CI Pipeline成功运行
- [ ] 所有测试通过
- [ ] 自动部署正常

---

### 3.8 iOS端 - 测试 ⭐️⭐️
**优先级:** 中 | **预计时间:** 4-5天

#### 任务清单:
- [ ] **单元测试**
  - 测试ViewModels逻辑
  - 测试数据模型转换
  - 测试工具函数
  - 使用 XCTest

- [ ] **UI测试**
  - 测试关键用户流程（登录、答题、查看结果）
  - 使用 XCUITest
  - 自动化测试脚本

- [ ] **快照测试**
  - 使用 SnapshotTesting 库
  - 捕获各种UI状态
  - 防止UI回归

- [ ] **网络Mock测试**
  - 测试MockNetworkService
  - 测试各种网络错误情况
  - 测试离线状态

- [ ] **性能测试**
  - 测试启动时间
  - 测试页面加载速度
  - 测试内存使用

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 关键流程有UI测试覆盖
- [ ] ViewModels有单元测试
- [ ] 快照测试捕获所有视图
- [ ] 性能符合标准

---

## 📱 Phase 4: 高级功能 (Future Enhancements)

**目标:** 增加竞争力的高级功能

**预计时间:** 4-6周

### 4.1 实时对战模式 ⭐️⭐️⭐️
**优先级:** 中 | **预计时间:** 7-10天

#### 功能描述:
两个用户同时答同一组题目，实时显示对方进度，比谁答得又快又准。

#### 任务清单:
- [ ] **后端 - WebSocket支持**
  - 使用 FastAPI WebSocket
  - 创建对战房间管理器
  - 实时同步答题进度
  - 实时计算分数和排名

- [ ] **后端 - 匹配系统**
  - 根据水平匹配对手
  - 随机匹配或好友对战
  - 等待队列管理

- [ ] **iOS端 - WebSocket客户端**
  - 集成WebSocket库（如Starscream）
  - 实时接收对手进度
  - 实时发送自己的进度

- [ ] **iOS端 - 对战UI**
  - 显示双方进度条
  - 实时分数对比
  - 胜负判定动画

#### 依赖关系:
- 依赖: Phase 1 所有功能

#### 验收标准:
- [ ] 可以成功匹配对手
- [ ] 实时同步正常
- [ ] 胜负判定准确
- [ ] 延迟 < 500ms

---

### 4.2 社交功能 ⭐️⭐️
**优先级:** 低 | **预计时间:** 5-7天

#### 功能描述:
好友系统、排行榜、学习小组

#### 任务清单:
- [ ] **好友系统**
  - 添加好友
  - 好友列表
  - 查看好友学习进度

- [ ] **排行榜**
  - 全局排行榜
  - 课程排行榜
  - 周/月排行榜
  - 积分系统

- [ ] **学习小组**
  - 创建小组
  - 加入小组
  - 小组内排行
  - 小组挑战赛

#### 依赖关系:
- 依赖: Phase 1 所有功能

#### 验收标准:
- [ ] 好友功能正常
- [ ] 排行榜实时更新
- [ ] 小组功能完整

---

### 4.3 AI辅助学习 ⭐️⭐️⭐️
**优先级:** 中 | **预计时间:** 10-14天

#### 功能描述:
集成AI（如GPT）提供解题提示、知识点讲解、学习建议

#### 任务清单:
- [ ] **后端 - AI集成**
  - 集成OpenAI API或本地模型
  - 创建提示词模板
  - 实现对话上下文管理

- [ ] **智能解题提示**
  - 用户答错后提供提示
  - 逐步提示，不直接给答案
  - 基于题目和知识点生成

- [ ] **知识点讲解**
  - AI生成知识点的详细解释
  - 结合用户的理解水平调整难度
  - 提供例题和练习

- [ ] **个性化学习建议**
  - 分析用户的学习数据
  - AI生成学习计划
  - 推荐学习资源

- [ ] **iOS端 - AI助手聊天界面**
  - 聊天UI（类似ChatGPT）
  - 显示AI解答
  - 支持追问

#### 依赖关系:
- 依赖: Phase 1, 3.5 (学习分析)

#### 验收标准:
- [ ] AI响应准确且有帮助
- [ ] 响应时间 < 5秒
- [ ] 聊天界面友好
- [ ] 成本可控

---

### 4.4 多语言支持 ⭐️
**优先级:** 低 | **预计时间:** 3-4天

#### 任务清单:
- [ ] **iOS端国际化**
  - 使用SwiftUI Localization
  - 翻译所有UI文本
  - 支持语言: 英语、简体中文、繁体中文

- [ ] **后端国际化**
  - 错误消息多语言
  - Accept-Language头部支持
  - 根据请求返回对应语言

- [ ] **题目和课程多语言**
  - 数据库schema支持多语言
  - 根据用户语言偏好返回内容

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 支持至少两种语言
- [ ] 语言切换流畅
- [ ] 翻译准确

---

### 4.5 学习提醒和推送通知 ⭐️⭐️
**优先级:** 中 | **预计时间:** 3-4天

#### 任务清单:
- [ ] **iOS端 - 本地通知**
  - 每日学习提醒
  - 测验截止提醒
  - 连续学习天数激励

- [ ] **iOS端 - 远程推送**
  - 集成APNs
  - 好友挑战通知
  - 新课程通知

- [ ] **后端 - 推送服务**
  - 创建推送任务
  - 定时发送
  - 用户推送偏好管理

#### 依赖关系:
- 无前置依赖

#### 验收标准:
- [ ] 通知准时发送
- [ ] 用户可以自定义通知设置
- [ ] 点击通知正确跳转

---

## 🔧 技术债务和重构 (Tech Debt)

**优先级:** 低-中 | **预计时间:** 持续进行

### 任务清单:
- [ ] **代码清理**
  - 删除注释掉的代码（如 `app/routes/quiz.py`）
  - 删除未使用的导入
  - 统一代码风格

- [ ] **文档补充**
  - 添加模块级docstring
  - 补充复杂函数的注释
  - 更新README

- [ ] **日志系统**
  - 使用结构化日志（如 `structlog`）
  - 统一日志格式
  - 日志级别配置

- [ ] **错误处理标准化**
  - 创建自定义异常类
  - 统一错误响应格式
  - 错误码体系

- [ ] **配置管理**
  - 环境变量验证
  - 配置文档
  - 敏感信息保护

- [ ] **数据库迁移**
  - 使用Alembic管理迁移
  - 版本控制
  - 回滚策略

---

## 📊 成功指标 (Success Metrics)

### Phase 1完成标准:
- [ ] 用户可以完整完成测验并看到成绩
- [ ] 三种题型都可以正常使用
- [ ] 所有核心功能端到端测试通过

### Phase 2完成标准:
- [ ] 管理员可以批量导入数据
- [ ] 离线模式正常工作
- [ ] Token刷新机制稳定

### Phase 3完成标准:
- [ ] API响应时间 < 200ms (P95)
- [ ] 测试覆盖率 > 80%
- [ ] 通过安全扫描
- [ ] 学习分析功能完整

### Phase 4完成标准:
- [ ] 高级功能根据需求选择性实现
- [ ] 用户满意度调查

---

## 🛠️ 开发流程建议

### 每日工作流:
1. **早晨:** Review昨日进度，计划今日任务
2. **开发:** 专注编码，遵循TDD（Test-Driven Development）
3. **午后:** Code review，集成测试
4. **傍晚:** 提交代码，更新Roadmap进度

### 每周检查点:
- **周一:** Sprint规划，选择本周任务
- **周三:** 中期检查，调整计划
- **周五:** Sprint回顾，演示进展

### 版本发布策略:
- **v0.1:** Phase 1完成，内部测试版
- **v0.5:** Phase 2完成，Beta版
- **v1.0:** Phase 3完成，正式版
- **v2.0:** Phase 4完成，高级版

---

## 📞 需要帮助？

如果在开发过程中遇到问题或需要技术指导，可以：
1. 参考代码注释和文档
2. 查看类似功能的实现
3. 咨询技术社区（Stack Overflow, GitHub Discussions）
4. 重新review这份Roadmap

---

## 📝 更新日志

**2025-10-25:** 初始版本创建，基于当前代码库分析

---

**祝你开发顺利！🚀**
